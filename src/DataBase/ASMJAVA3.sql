/*
Ngay tao 16/7/2022
Kết nối với Asmjav3
*/

CREATE DATABASE STUDENTMANAGER
ON
(
	NAME = STUDENTMANAGER_dat,
	FILENAME = 'D:\JAVA3\STUDENTMANAGER.dat',
	SIZE = 10,
	MAXSIZE = 50,
	FILEGROWTH = 5
)
LOG ON
(
	NAME = STUDENTMANAGER_ldf,
	FILENAME = 'D:\JAVA3\STUDENTMANAGER.ldf',
	SIZE = 10MB,
	MAXSIZE = 50MB,
	FILEGROWTH = 5MB

)
GO
USE STUDENTMANAGER
GO

CREATE TABLE USERS
(
	USERNAME NVARCHAR(10) NOT NULL PRIMARY KEY,
	PASSWORD NVARCHAR(10) ,
	ROLE NVARCHAR(5)
)
GO
CREATE TABLE STUDENTS
(
	MASV NVARCHAR(7) NOT NULL PRIMARY KEY,
	HOTEN NVARCHAR(50),
	EMAIL NVARCHAR(50),
	SODT NVARCHAR(12),
	GIOITINH BIT,
	DIACHI NVARCHAR(100),
	HINH NVARCHAR(50)

)
GO
CREATE TABLE GRADE 
(
	ID INT NOT NULL,
	MASV NVARCHAR(7) REFERENCES STUDENTS(MASV),
	TOAN FLOAT,
	NGUVAN FLOAT,
	TIENGANH FLOAT

)
INSERT INTO USERS VALUES (N'admin',N'12345','ad')

INSERT INTO USERS VALUES (N'teacher',N'12345','gv')
INSERT INTO USERS VALUES (N'student',N'12345','sv')


ALTER TABLE students
  ADD HINH NVARCHAR(300);
GO

CREATE  TRIGGER ADD_GRADE ON STUDENTS INSTEAD OF INSERT
 AS
 BEGIN 
	INSERT INTO STUDENTS SELECT *  FROM inserted
	INSERT INTO GRADE VALUES (( SELECT MASV FROM inserted),NULL,NULL,NULL)
 END
 GO

 INSERT INTO STUDENTS VALUES (N'PS37775',N'Huỳnh Thị Mỹ Ngọc',N'Ngoc@fpt.edu.vn',N'0377379289',0,N'Quận 1 ,TP HCM',null)

 SELECT * FROM GRADE
 SELECT * FROM STUDENTS